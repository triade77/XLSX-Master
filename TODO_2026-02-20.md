# XLSX-Master TODO
> 작성일: 2026-02-20
> 1단계 PoC 완료 기준 — 남은 2~4단계 작업 목록

---

## 2단계 — 래퍼 고도화

### 데이터 & 테이블 (`2.1`)
- [x] `IEnumerable<T>` 제네릭 바인딩: 리플렉션으로 헤더 자동 생성 + 타입별 셀 포맷 자동 매핑
  - `string` → 텍스트, `int/double/decimal` → 숫자, `DateTime` → 날짜 포맷
- [x] `DataTable` 바인딩 지원 (`InsertMasterTable(DataTable)` 확장 메서드)
- [x] 삽입된 범위를 Excel Table 객체로 변환 (`AddExcelTable()`): 자동 필터 + 테이블 스타일

### Fluent API 보완
- [x] `SetTitle()` 생략 시 제목 없는 차트 정상 생성 검증 (AutoTitleDeleted=true 설정)
- [x] `ShowLegend(false)` 동작 확인 및 테스트 추가
- [x] 체이닝 없이 `AddMasterChart` 만 호출 후 저장 시 예외 메시지 개선 (앵커·메서드명 포함)

### 저장 API
- [x] `SaveWithCharts(Stream destination)` 오버로드 추가 (기존 스트림에 쓰기)
- [ ] `workbook.SaveAs()` 그대로 써도 차트가 포함되는 투명 훅 방식 검토
  - ClosedXML이 SaveAs 이벤트/훅을 미제공 → **구현 불가** (알려진 제약 사항으로 확정)

---

## 3단계 — 고급 시각화

### 차트 타입 확장
- [x] `ChartType.Pie` 구현 (`PieChart`, `PieChartSeries`, 축 없음)
- [x] `ChartType.Scatter` 구현 (`AddScatterSeries()` 전용 API, `ScatterChart`, X/Y `ValueAxis` 2개)
- [x] `ChartType.AreaStacked` 추가 (`GroupingValues.Stacked`)

### 축 커스터마이징
- [x] `SetYAxisMin(double)` / `SetYAxisMax(double)`: 주 Y축 범위 수동 지정
- [x] `SetYAxisTitle(string)`: Y축 레이블 텍스트 설정
- [x] `SetXAxisTitle(string)`: X축 레이블 텍스트 설정
- [x] 보조 Y축 범위 독립 지정: `SetSecondaryYAxisMin/Max()`

### 시각 스타일
- [x] `SetSeriesColor(string seriesName, string hexColor)`: 계열 색상 커스터마이징
- [x] `SetChartStyle(int styleId)`: Excel 내장 차트 스타일 번호(1~48) 적용
- [x] 데이터 레이블 표시 옵션 (`ShowDataLabels(bool)`)
- [x] 마커 모양 설정 (꺾은선 계열용): `SetMarkerStyle()` — Auto/None/Circle/Square/Diamond/Triangle

### 동적 범위
- [ ] Named Range 지원 — 이번 단계 제외 (4단계 이후 검토)

---

## 4단계 — 안정화 & 품질 ✅ 완료 (2026-02-23)

### 예외 처리
- [x] 잘못된 anchor 문자열 → `ArgumentException` (`FormatException`에서 변경)
- [x] anchor 역순 범위(`M20:E1`) → `ArgumentException` + 역순 안내 메시지
- [x] 존재하지 않는 시트명 → `KeyNotFoundException` + 사용 가능 시트 목록 출력
- [x] 빈 데이터 범위 → `InvalidOperationException` 조기 감지 (기존 구현 확인)
- [ ] anchor 범위가 데이터 범위보다 작을 때 경고 — 미구현 (향후 검토)

### 성능 테스트
- [x] 10만 행 데이터 삽입 후 차트 생성 — 5초 이내 통과
- [x] 동일 워크북에 차트 10개 주입 — 정상 완료 확인
- [ ] `MemoryStream` 중간 복사 최소화 리팩터링 — 성능 기준 통과로 불필요 판단

### 테스트 커버리지
- [x] `ChartXmlGeneratorTests.cs` 작성 (6개)
  - BarChart 2계열, LineChart/AreaChart 1계열, 보조축 ValAx×2, 제목 있음/없음
- [x] `ExceptionTests.cs` 작성 (5개): 잘못된 앵커, 역순, 시트 없음+목록, 계열 없음, X축 없음
- [x] `PerformanceTests.cs` 작성 (2개): 10만 행, 차트 10개
- [x] `DataTable` 바인딩 통합 테스트 — `DataBindingTests.cs`에 기존 15개 완료

### 문서화
- [x] 각 public API에 XML 문서 주석 완성 (기존 100% 완료 확인)
- [x] `README.md` 작성: 설치 방법, 빠른 시작, API 레퍼런스, 차트 타입 목록, 제약 사항
- [x] NuGet 패키지 메타데이터 완성 (csproj: PackageTags, PackageLicenseExpression, Copyright 등)

---

## 완료 항목 (4단계 안정화 & 품질 — 2026-02-23)
- [x] `EmuCalculator.ParseAnchor()`: `FormatException` → `ArgumentException`, 역순 검증 추가
- [x] `XlsxChartInjector.FindSheetPath()`: `KeyNotFoundException` 메시지에 사용 가능 시트 목록 포함
- [x] `ChartXmlGeneratorTests.cs` 신규 (6개 테스트)
- [x] `ExceptionTests.cs` 신규 (5개 테스트) — `InternalsVisibleTo` 추가로 내부 API 직접 테스트
- [x] `PerformanceTests.cs` 신규 (2개 테스트) — 10만 행 5초 이내, 차트 10개 주입 성공
- [x] `README.md` 신규 작성 (설치·빠른 시작·API 레퍼런스·제약 사항)
- [x] `XLSX-Master.csproj` NuGet 메타데이터 추가
- [x] 전체 테스트 **57개 통과** (5.5초)

## 완료 항목 (2단계 래퍼 고도화 — 2026-02-23)
- [x] `WorksheetDataExtensions.InsertMasterTable<T>()` — 리플렉션 기반 제네릭 바인딩, 타입별 포맷
- [x] `WorksheetDataExtensions.InsertMasterTable(DataTable)` — DataTable 바인딩
- [x] `RangeExtensions.AddExcelTable()` — Excel Table 변환, 자동 필터, 테이블 스타일
- [x] `ChartXmlGenerator`: SetTitle() 생략 시 AutoTitleDeleted=true 처리
- [x] `MasterChartBuilder`: 에러 메시지에 앵커·메서드명 포함
- [x] `WorkbookExtensions.SaveWithCharts(Stream)` — 스트림 대상 오버로드
- [x] `DataBindingTests.cs` — 데이터 바인딩 테스트 15개 추가
- [x] `IntegrationTests.cs` — Fluent API 보완 테스트 5개 추가
- [x] 전체 테스트 32개 통과

## 완료 항목 (1단계 PoC — 2026-02-20)
- [x] 프로젝트 구조 생성 (sln + 3 csproj, VS 2019 호환)
- [x] `ChartType`, `AxisPosition`, `SeriesDefinition` 모델
- [x] `EmuCalculator` — 셀 주소 → EMU 변환
- [x] `RidManager` — Relationship ID 충돌 없이 할당
- [x] `ChartXmlGenerator` — Column / Line / Area / Bar 차트 XML 생성
- [x] `XlsxChartInjector` — ZipArchive 직접 조작으로 chart/drawing 주입 (표준 상대 URI)
- [x] `MasterChartBuilder` — Fluent API 빌더
- [x] `WorksheetExtensions.AddMasterChart()` 확장 메서드
- [x] `WorkbookExtensions.SaveWithCharts()` 확장 메서드
- [x] `ChartRegistry` — ConditionalWeakTable 기반 빌더 등록
- [x] 샘플 앱 2개 (단일 Column, 콤보+보조축)
- [x] 테스트 12개 전부 통과 (OpenXmlValidator 검증 포함)
- [x] Excel 복구 오류 수정: `BuildSeriesText`의 `c:strLit` → `c:v` (CT_SerTx 스키마 준수)
